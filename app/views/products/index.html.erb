<% content_for :title, "Browse Products | YDP" %>

<%= render "shared/navbar" %>

<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-14 space-y-10">
  <header class="text-center space-y-4">
    <p class="uppercase text-xs tracking-[0.4em] font-semibold text-slate-500">Collection</p>
    <h1 class="text-3xl md:text-4xl font-semibold">Browse Products</h1>
    <p class="text-slate-500 text-sm md:text-base max-w-2xl mx-auto">Curated silhouettes crafted with effortless sophistication and sustainable fabrics. Discover pieces that move with you and elevate your every day.</p>
    <% if @products.present? %>
      <p class="text-sm text-slate-500">Showing <span class="font-medium text-ink"><%= @products.size %></span> items</p>
    <% end %>
  </header>

  <% if @error.present? %>
    <div class="bg-white border border-red-200 text-red-600 px-6 py-4 rounded-2xl text-center shadow-sm">
      <p class="font-medium"><%= @error %></p>
      <p class="text-sm text-red-400 mt-1">Please refresh the page or try again later.</p>
    </div>
  <% elsif @products.blank? %>
    <div class="bg-white border border-slate-200 px-6 py-10 rounded-3xl text-center shadow-sm">
      <p class="text-lg font-medium text-ink">No products available at the moment.</p>
      <p class="text-sm text-slate-500 mt-2">Check back soon as we continue to refresh the collection.</p>
    </div>
  <% else %>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <% @products.each_with_index do |product, index| %>
        <article class="group relative bg-white rounded-3xl overflow-hidden shadow-sm hover:shadow-card transition-all duration-500 ease-out hover:-translate-y-1">
          <div class="absolute top-4 right-4 z-10">
            <button type="button" class="flex items-center justify-center w-10 h-10 rounded-full bg-white/90 text-slate-500 hover:text-rose-500 shadow-md transition duration-300 ease-out hover:-translate-y-0.5">
              <span class="sr-only">Add to wishlist</span>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.17 5.17a4.5 4.5 0 0 1 6.36 0L12 7.64l2.47-2.47a4.5 4.5 0 1 1 6.36 6.36L12 20.36l-8.83-8.83a4.5 4.5 0 0 1 0-6.36Z" />
              </svg>
            </button>
          </div>
          <div class="relative flex flex-col">
            <div class="aspect-[4/5] bg-mist flex items-center justify-center p-6 overflow-hidden">
              <img src="<%= product["image"] %>" alt="<%= product["title"] %>" class="h-full object-contain transition-transform duration-500 ease-out group-hover:scale-105">
            </div>
            <div class="flex-1 flex flex-col p-6 space-y-3">
              <div class="flex items-center justify-between text-xs uppercase tracking-[0.3em] text-slate-400">
                <span><%= product["category"].to_s.titleize %></span>
                <span><%= format("%02d", index + 1) %></span>
              </div>
              <h2 class="text-lg font-semibold text-ink line-clamp-2 min-h-[3.5rem]">
                <%= product["title"] %>
              </h2>
              <p class="text-sm text-slate-500 line-clamp-2 min-h-[2.75rem]">
                <%= truncate(product["description"], length: 120) %>
              </p>
              <div class="flex items-center justify-between pt-2">
                <p class="text-xl font-semibold"><%= number_to_currency(product["price"], precision: 2) %></p>
                <a href="<%= product_path(product["id"]) %>" class="inline-flex items-center gap-2 text-sm font-medium text-ink/70 group-hover:text-ink transition">
                  <span>View Details</span>
                  <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </article>
      <% end %>
    </div>
  <% end %>
</section>

<%= render "shared/loyalty_banner" %>
<%= render "shared/footer_links" %>
