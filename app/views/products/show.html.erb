<% if @product.present? %>
  <% content_for :title, "#{@product["title"]} | Supra" %>
<% else %>
  <% content_for :title, "Product Details | Supra" %>
<% end %>

<%= render "shared/navbar" %>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16 space-y-12">
  <% if @error.present? %>
    <div class="bg-white border border-red-200 text-red-600 px-6 py-6 rounded-3xl text-center shadow-sm">
      <p class="font-medium"><%= @error %></p>
      <p class="text-sm text-red-400 mt-2" data-i18n data-i18n-en="Please return to the catalog and try again." data-i18n-th="โปรดกลับไปที่หน้ารวมสินค้าแล้วลองใหม่อีกครั้ง">Please return to the catalog and try again.</p>
      <div class="mt-6">
        <a href="<%= root_path %>" class="inline-flex items-center gap-2 rounded-full bg-ink px-5 py-2 text-sm font-semibold text-white transition hover:bg-black">
          <span aria-hidden="true">←</span>
          <span data-i18n data-i18n-en="Back to products" data-i18n-th="กลับไปหน้าสินค้า">Back to products</span>
        </a>
      </div>
    </div>
  <% elsif @product.present? %>
    <nav aria-label="Breadcrumb" class="text-sm text-slate-500 flex flex-wrap items-center gap-2">
      <a href="<%= root_path %>" class="hover:text-ink transition">
        <span data-i18n data-i18n-en="Home" data-i18n-th="หน้าแรก">Home</span>
      </a>
      <span>/</span>
      <%= link_to @product["category"].to_s.titleize, root_path(anchor: "collections"), class: "hover:text-ink transition" %>
      <span>/</span>
      <span class="text-ink font-medium"><%= truncate(@product["title"], length: 60) %></span>
    </nav>

    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.05fr)_minmax(0,0.95fr)] items-start">
      <div class="space-y-6">
        <div class="group relative overflow-hidden rounded-[32px] bg-white shadow-glow border border-white/40">
          <div class="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-brand via-accent to-brand"></div>
          <div class="aspect-[4/5] bg-brand/5 flex items-center justify-center p-6">
            <img src="<%= @product["image"] %>" alt="<%= @product["title"] %>" class="h-full object-contain transition-transform duration-700 ease-out group-hover:scale-105">
          </div>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <div class="rounded-2xl bg-white p-5 shadow-sm border border-slate-100">
            <div class="flex items-center gap-3">
              <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-brand/20 text-ink">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a5 5 0 1 0-7.18 0L12 17.94l3.59-3.57Zm4.16-6.14A9 9 0 1 1 4.25 8.24" />
                </svg>
              </span>
              <div>
                <p class="font-semibold text-ink" data-i18n data-i18n-en="Free returns" data-i18n-th="คืนฟรี">Free returns</p>
                <p class="text-xs text-slate-500" data-i18n data-i18n-en="30-day hassle-free exchanges." data-i18n-th="เปลี่ยนหรือคืนภายใน 30 วัน">30-day hassle-free exchanges.</p>
              </div>
            </div>
          </div>
          <div class="rounded-2xl bg-white p-5 shadow-sm border border-slate-100">
            <div class="flex items-center gap-3">
              <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-brand/20 text-ink">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l3 3" />
                </svg>
              </span>
              <div>
                <p class="font-semibold text-ink" data-i18n data-i18n-en="Express checkout" data-i18n-th="จ่ายด่วน">Express checkout</p>
                <p class="text-xs text-slate-500" data-i18n data-i18n-en="SupraPay and PromptPay supported." data-i18n-th="รองรับ SupraPay และพร้อมเพย์">SupraPay and PromptPay supported.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="space-y-8">
        <header class="space-y-3">
          <p class="uppercase text-xs tracking-[0.35em] font-semibold text-brand"><%= @product["category"].to_s.titleize %></p>
          <h1 class="text-3xl md:text-4xl font-semibold text-ink leading-tight"><%= @product["title"] %></h1>
          <p class="text-slate-500 leading-relaxed"><%= @product["description"] %></p>
        </header>

        <div class="flex flex-wrap items-center gap-4">
          <p class="text-3xl font-semibold text-ink"><%= number_to_currency(@product["price"], precision: 2) %></p>
          <span class="inline-flex items-center gap-2 rounded-full bg-brand/10 px-4 py-2 text-sm font-medium text-brand">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15l4.5-4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
            <span data-i18n data-i18n-en="In stock" data-i18n-th="มีของพร้อมส่ง">In stock</span>
          </span>
        </div>

        <div class="flex flex-wrap gap-3">
          <button type="button" class="inline-flex items-center justify-center rounded-full bg-brand px-8 py-3 text-base font-semibold text-white shadow-glow transition-transform duration-300 hover:-translate-y-0.5 hover:bg-brand-dark">
            <span data-i18n data-i18n-en="Add to cart" data-i18n-th="เพิ่มลงตะกร้า">Add to cart</span>
          </button>
          <button type="button" class="inline-flex items-center justify-center gap-2 rounded-full border border-slate-300 px-8 py-3 text-base font-semibold text-ink/80 transition hover:border-brand hover:text-brand">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.17 5.17a4.5 4.5 0 0 1 6.36 0L12 7.64l2.47-2.47a4.5 4.5 0 1 1 6.36 6.36L12 20.36l-8.83-8.83a4.5 4.5 0 0 1 0-6.36Z" />
            </svg>
            <span data-i18n data-i18n-en="Wishlist" data-i18n-th="บันทึก">Wishlist</span>
          </button>
          <button type="button" class="inline-flex items-center justify-center gap-2 rounded-full border border-slate-300 px-8 py-3 text-base font-semibold text-ink/80 transition hover:border-brand hover:text-brand" data-modal-trigger="topup-modal">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            <span data-i18n data-i18n-en="Top up &amp; buy" data-i18n-th="เติมตังแล้วซื้อ">Top up &amp; buy</span>
          </button>
        </div>

        <div class="flex flex-wrap gap-3 text-xs uppercase tracking-[0.3em] text-slate-400">
          <span class="inline-flex items-center rounded-full bg-white px-4 py-2 shadow-sm">Quick Dry</span>
          <span class="inline-flex items-center rounded-full bg-white px-4 py-2 shadow-sm">Thai Weather Ready</span>
          <span class="inline-flex items-center rounded-full bg-white px-4 py-2 shadow-sm">Machine Wash</span>
        </div>

        <div class="space-y-4">
          <details class="group rounded-2xl bg-white p-6 shadow-sm border border-slate-100" open>
            <summary class="flex items-center justify-between cursor-pointer text-base font-semibold text-ink">
              <span data-i18n data-i18n-en="Product details" data-i18n-th="รายละเอียดสินค้า">Product details</span>
              <svg class="w-5 h-5 transition-transform duration-300 group-open:rotate-180" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25 12 15.75l-7.5-7.5" />
              </svg>
            </summary>
            <div class="mt-4 space-y-2 text-sm text-slate-500 leading-relaxed">
              <p data-i18n data-i18n-en="Premium fabric blend tailored for hot climates with breathable weaves." data-i18n-th="ผ้าพรีเมียมระบายอากาศ เหมาะกับอากาศร้อนชื้น">Premium fabric blend tailored for hot climates with breathable weaves.</p>
              <p data-i18n data-i18n-en="Inclusive sizing with hidden pockets and adaptive stretch panels." data-i18n-th="มีทุกไซซ์ พร้อมกระเป๋าซ่อนและผ้ายืดหยุ่นตามสรีระ">Inclusive sizing with hidden pockets and adaptive stretch panels.</p>
            </div>
          </details>
          <details class="group rounded-2xl bg-white p-6 shadow-sm border border-slate-100">
            <summary class="flex items-center justify-between cursor-pointer text-base font-semibold text-ink">
              <span data-i18n data-i18n-en="Shipping &amp; return" data-i18n-th="การจัดส่งและคืนสินค้า">Shipping &amp; return</span>
              <svg class="w-5 h-5 transition-transform duration-300 group-open:rotate-180" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25 12 15.75l-7.5-7.5" />
              </svg>
            </summary>
            <div class="mt-4 space-y-2 text-sm text-slate-500 leading-relaxed">
              <p data-i18n data-i18n-en="Free shipping nationwide over ฿999. Express same-day in Bangkok." data-i18n-th="จัดส่งฟรีทั่วไทยเมื่อสั่งเกิน 999 บาท มีด่วนภายในวันในกรุงเทพ">Free shipping nationwide over ฿999. Express same-day in Bangkok.</p>
              <p data-i18n data-i18n-en="Returns accepted within 30 days. LINE OA support for quick swaps." data-i18n-th="คืนได้ภายใน 30 วัน มีเจ้าหน้าที่ LINE OA ช่วยดูแล">Returns accepted within 30 days. LINE OA support for quick swaps.</p>
            </div>
          </details>
          <details class="group rounded-2xl bg-white p-6 shadow-sm border border-slate-100">
            <summary class="flex items-center justify-between cursor-pointer text-base font-semibold text-ink">
              <span data-i18n data-i18n-en="Care instructions" data-i18n-th="วิธีดูแล">Care instructions</span>
              <svg class="w-5 h-5 transition-transform duration-300 group-open:rotate-180" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25 12 15.75l-7.5-7.5" />
              </svg>
            </summary>
            <div class="mt-4 space-y-2 text-sm text-slate-500 leading-relaxed">
              <p data-i18n data-i18n-en="Machine wash cold with mild detergent, hang dry indoors." data-i18n-th="ซักเครื่องน้ำเย็นด้วยน้ำยาสูตรอ่อน ตากในที่ร่ม">Machine wash cold with mild detergent, hang dry indoors.</p>
              <p data-i18n data-i18n-en="Avoid bleach, press with warm iron if needed." data-i18n-th="หลีกเลี่ยงสารฟอกขาว รีดอุ่นได้ตามต้องการ">Avoid bleach, press with warm iron if needed.</p>
            </div>
          </details>
        </div>

        <div id="ai-concierge" class="rounded-3xl border border-brand/30 bg-brand/10 p-6 shadow-sm space-y-4">
          <h2 class="text-xl font-semibold text-ink" data-i18n data-i18n-en="Need advice?" data-i18n-th="ต้องการคำแนะนำ?">Need advice?</h2>
          <p class="text-sm text-slate-500" data-i18n data-i18n-en="Chat with Supra Concierge AI for Thai or English guidance." data-i18n-th="พูดคุยกับ Supra Concierge AI ได้ทั้งภาษาไทยและอังกฤษ">Chat with Supra Concierge AI for Thai or English guidance.</p>
          <a href="#ai-concierge" class="inline-flex items-center gap-2 rounded-full bg-white px-5 py-3 text-sm font-semibold text-brand border border-brand/40 hover:bg-brand hover:text-white transition">
            <span data-i18n data-i18n-en="Open AI chat" data-i18n-th="เปิดแชท AI">Open AI chat</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <% if @recommended_products.present? %>
      <section class="space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div>
            <h2 class="text-2xl font-semibold text-ink" data-i18n data-i18n-en="You may also like" data-i18n-th="คุณอาจชอบ">You may also like</h2>
            <p class="text-sm text-slate-500" data-i18n data-i18n-en="Popular picks curated for Thai shoppers." data-i18n-th="สินค้ายอดฮิตที่คนไทยชื่นชอบ">Popular picks curated for Thai shoppers.</p>
          </div>
          <a href="<%= root_path %>" class="text-sm font-semibold text-brand hover:text-brand-dark">
            <span data-i18n data-i18n-en="Back to browse" data-i18n-th="กลับไปเลือกซื้อ">Back to browse</span>
          </a>
        </div>
        <div class="grid gap-6 md:grid-cols-2">
          <% @recommended_products.each do |product| %>
            <article class="rounded-3xl border border-slate-100 bg-white/90 p-6 shadow-sm transition hover:shadow-card">
              <div class="flex flex-col sm:flex-row gap-5">
                <div class="flex-shrink-0">
                  <div class="h-28 w-28 rounded-2xl bg-brand/5 flex items-center justify-center overflow-hidden">
                    <img src="<%= product["image"] %>" alt="<%= product["title"] %>" class="h-full w-full object-contain">
                  </div>
                </div>
                <div class="flex-1 space-y-3">
                  <h3 class="text-lg font-semibold text-ink line-clamp-2"><%= product["title"] %></h3>
                  <p class="text-sm text-slate-500 line-clamp-2"><%= truncate(product["description"], length: 120) %></p>
                  <div class="flex items-center justify-between">
                    <p class="text-lg font-semibold text-ink"><%= number_to_currency(product["price"], precision: 2) %></p>
                      <a href="<%= product_path(product["id"]) %>" class="inline-flex items-center gap-2 rounded-full bg-brand px-4 py-2 text-sm font-semibold text-white shadow-glow hover:bg-brand-dark transition">
                        <span data-i18n data-i18n-en="View" data-i18n-th="ดู">View</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
                        </svg>
                      </a>
                  </div>
                </div>
              </div>
            </article>
          <% end %>
        </div>
      </section>
    <% end %>
  <% else %>
    <div class="bg-white border border-slate-200 px-6 py-10 rounded-3xl text-center shadow-sm">
      <p class="text-lg font-medium text-ink" data-i18n data-i18n-en="Product details are currently unavailable." data-i18n-th="ข้อมูลสินค้าไม่พร้อมใช้งาน">Product details are currently unavailable.</p>
      <p class="text-sm text-slate-500 mt-2" data-i18n data-i18n-en="Please return to the collection to continue browsing." data-i18n-th="โปรดกลับไปที่หน้ารวมสินค้าเพื่อเลือกชมต่อ">Please return to the collection to continue browsing.</p>
      <div class="mt-6">
          <a href="<%= root_path %>" class="inline-flex items-center gap-2 rounded-full bg-ink px-5 py-2 text-sm font-semibold text-white transition hover:bg-black">
            <span aria-hidden="true">←</span>
            <span data-i18n data-i18n-en="Back to products" data-i18n-th="กลับไปหน้าสินค้า">Back to products</span>
          </a>
      </div>
    </div>
  <% end %>
</div>

<%= render "shared/loyalty_banner" %>
<%= render "shared/footer_links" %>
